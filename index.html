<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Scoop Duty KC — Pet Waste Removal in the KC Metro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    .service-card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0,0,0,.1), 0 10px 10px -5px rgba(0,0,0,.04); }
  </style>
</head>
<body class="font-sans bg-gray-50">
  <nav class="bg-white shadow-md sticky top-0 z-50">
    <div class="container mx-auto px-6 py-4">
      <div class="flex justify-between items-center">
        <div class="text-2xl font-bold text-green-600">
          Scoop Duty <span class="text-green-800">KC</span>
        </div>
        <div class="hidden md:flex space-x-3">
          <a href="/billing" class="px-4 py-2 rounded-md bg-gray-100 hover:bg-gray-200 transition font-medium">
            Billing
          </a>
          <button id="loginBtn" class="px-4 py-2 rounded-md bg-green-600 text-white hover:bg-green-700 transition font-medium">
            Login
          </button>
          <button id="signupBtn" class="px-4 py-2 rounded-md bg-green-800 text-white hover:bg-green-900 transition font-medium">
            Sign Up
          </button>
        </div>
        <button class="md:hidden focus:outline-none"><i data-feather="menu"></i></button>
      </div>
    </div>
  </nav>

  <section class="relative">
    <img src="https://www.scoop-duty.com/images/hero-yard.jpg" alt="Clean backyard ready for pets" class="w-full h-[70vh] object-cover">
  </section>

  <section id="services" class="py-20 bg-white">
    <div class="container mx-auto px-6">
      <h2 class="text-3xl font-bold text-center text-gray-800 mb-16" data-aos="fade-up">Our Services</h2>
      <div class="grid md:grid-cols-3 gap-8">
        <div class="service-card bg-white p-8 rounded-xl shadow-lg transition duration-300" data-aos="fade-up" data-aos-delay="100">
          <div class="text-green-600 mb-4"><i data-feather="home" class="w-10 h-10"></i></div>
          <h3 class="text-xl font-bold mb-3 text-gray-800">Yard Scooping</h3>
          <p class="text-gray-600">Professional pet waste removal to keep your yard clean and sanitary.</p>
        </div>
        <div class="service-card bg-white p-8 rounded-xl shadow-lg transition duration-300" data-aos="fade-up" data-aos-delay="200">
          <div class="text-green-600 mb-4"><i data-feather="activity" class="w-10 h-10"></i></div>
          <h3 class="text-xl font-bold mb-3 text-gray-800">Doggy Playtime</h3>
          <p class="text-gray-600">Fun and engaging play sessions for your furry friends while you're away.</p>
        </div>
        <div class="service-card bg-white p-8 rounded-xl shadow-lg transition duration-300" data-aos="fade-up" data-aos-delay="300">
          <div class="text-green-600 mb-4"><i data-feather="box" class="w-10 h-10"></i></div>
          <h3 class="text-xl font-bold mb-3 text-gray-800">Litter Trade</h3>
          <p class="text-gray-600">Regular litter box cleaning and fresh litter replacement service.</p>
        </div>
      </div>
    </div>
  </section>

  <section id="pricing" class="py-20 bg-gray-50">
    <div class="container mx-auto px-6">
      <h2 class="text-3xl font-bold text-center text-gray-800 mb-16" data-aos="fade-up">Simple Pricing</h2>

      <div class="max-w-4xl mx-auto" data-aos="fade-up">
        <div class="mb-6">
          <select id="serviceType" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-gray-700 font-medium">
            <option value="yard-scooping">Yard Scooping</option>
            <option value="doggy-playtime">Doggy Playtime</option>
            <option value="litter-trade">Litter Trade</option>
          </select>
        </div>

        <div id="yard-scooping-options" class="bg-white rounded-xl shadow-lg overflow-hidden">
          <div class="md:flex">
            <div class="p-8 md:w-1/2 bg-green-50">
              <h3 class="text-2xl font-bold text-green-700 mb-4">Yard Scooping</h3>
              <div class="space-y-6">
                <div>
                  <label class="block text-gray-700 font-medium mb-2">Frequency</label>
                  <select data-field="frequency" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                    <option>One-Time</option>
                    <option>Weekly</option>
                    <option>Twice Weekly</option>
                    <option>Three Weekly</option>
                  </select>
                </div>
                <div>
                  <label class="block text-gray-700 font-medium mb-2">Yard Size</label>
                  <select data-field="yardSize" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                    <option>Small Yard (under 5,000 sq ft)</option>
                    <option>Medium Yard (5,000-10,000 sq ft)</option>
                    <option>Large Yard (over 10,000 sq ft)</option>
                  </select>
                </div>
                <div>
                  <label class="block text-gray-700 font-medium mb-2">Number of Pets</label>
                  <select data-field="pets" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                    <option>1 Dog</option>
                    <option>2 Dogs</option>
                    <option>3 Dogs</option>
                    <option>4 Dogs</option>
                    <option>5+ Dogs</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="p-8 md:w-1/2 flex flex-col justify-center items-center bg-white">
              <div class="text-center">
                <div class="js-price text-4xl font-bold text-green-600 mb-2">$—</div>
                <div class="js-frequency-label text-gray-600 mb-6">weekly</div>
                <button class="js-checkout-btn bg-green-600 text-white px-8 py-3 rounded-full font-semibold hover:bg-green-700 transition">
                  Get Started
                </button>
                <div class="js-note mt-2 text-sm text-gray-500"></div>
              </div>
            </div>
          </div>
        </div>

        <div id="doggy-playtime-options" class="bg-white rounded-xl shadow-lg overflow-hidden hidden">
          <div class="md:flex">
            <div class="p-8 md:w-1/2 bg-green-50">
              <h3 class="text-2xl font-bold text-green-700 mb-4">Doggy Playtime</h3>
              <div class="space-y-6">
                <div>
                  <label class="block text-gray-700 font-medium mb-2">Frequency</label>
                  <select data-field="frequency" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                    <option>One-Time</option>
                    <option>Weekly</option>
                    <option>Twice Weekly</option>
                    <option>Three Weekly</option>
                  </select>
                </div>
                <div>
                  <label class="block text-gray-700 font-medium mb-2">Number of Pets</label>
                  <select data-field="pets" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                    <option>1 Dog</option>
                    <option>2 Dogs</option>
                    <option>3 Dogs</option>
                    <option>4 Dogs</option>
                    <option>5+ Dogs</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="p-8 md:w-1/2 flex flex-col justify-center items-center bg-white">
              <div class="text-center">
                <div class="js-price text-4xl font-bold text-green-600 mb-2">$—</div>
                <div class="js-frequency-label text-gray-600 mb-6">weekly</div>
                <button class="js-checkout-btn bg-green-600 text-white px-8 py-3 rounded-full font-semibold hover:bg-green-700 transition">
                  Get Started
                </button>
                <div class="js-note mt-2 text-sm text-gray-500"></div>
              </div>
            </div>
          </div>
        </div>

        <div id="litter-trade-options" class="bg-white rounded-xl shadow-lg overflow-hidden hidden">
          <div class="md:flex">
            <div class="p-8 md:w-1/2 bg-green-50">
              <h3 class="text-2xl font-bold text-green-700 mb-4">Litter Trade</h3>
              <div class="space-y-6">
                <div>
                  <label class="block text-gray-700 font-medium mb-2">Frequency</label>
                  <select data-field="frequency" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                    <option>One-Time</option>
                    <option>Weekly</option>
                    <option>Twice Weekly</option>
                    <option>Three Weekly</option>
                  </select>
                </div>
                <div>
                  <label class="block text-gray-700 font-medium mb-2">Number of Boxes</label>
                  <select data-field="boxes" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                    <option>1 Box</option>
                    <option>2 Boxes</option>
                    <option>3 Boxes</option>
                    <option>4+ Boxes</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="p-8 md:w-1/2 flex flex-col justify-center items-center bg-white">
              <div class="text-center">
                <div class="js-price text-4xl font-bold text-green-600 mb-2">$—</div>
                <div class="js-frequency-label text-gray-600 mb-6">weekly</div>
                <button class="js-checkout-btn bg-green-600 text-white px-8 py-3 rounded-full font-semibold hover:bg-green-700 transition">
                  Get Started
                </button>
                <div class="js-note mt-2 text-sm text-gray-500"></div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <section id="faq" class="py-20 bg-white">
    <div class="container mx-auto px-6 max-w-4xl">
      <h2 class="text-3xl font-bold text-center text-gray-800 mb-16" data-aos="fade-up">Frequently Asked Questions</h2>
      <div class="space-y-6">
        <div class="border-b pb-4" data-aos="fade-up">
          <button class="flex justify-between items-center w-full text-left focus:outline-none">
            <h3 class="text-lg font-medium text-gray-800">What areas does Scoop Duty KC service?</h3>
            <i data-feather="chevron-down" class="text-green-600"></i>
          </button>
          <div class="mt-2 text-gray-600">We proudly service the Greater Kansas City Area.</div>
        </div>
        <div class="border-b pb-4" data-aos="fade-up" data-aos-delay="100">
          <button class="flex justify-between items-center w-full text-left focus:outline-none">
            <h3 class="text-lg font-medium text-gray-800">What do you do with the poop after cleaning?</h3>
            <i data-feather="chevron-down" class="text-green-600"></i>
          </button>
          <div class="mt-2 text-gray-600">We take it with us to one of our disposal sites.</div>
        </div>
        <div class="border-b pb-4" data-aos="fade-up" data-aos-delay="200">
          <button class="flex justify-between items-center w-full text-left focus:outline-none">
            <h3 class="text-lg font-medium text-gray-800">When is my start date?</h3>
            <i data-feather="chevron-down" class="text-green-600"></i>
          </button>
          <div class="mt-2 text-gray-600">After checkout, choose a preferred date. We'll email you your start date.</div>
        </div>
        <div class="border-b pb-4" data-aos="fade-up" data-aos-delay="300">
          <button class="flex justify-between items-center w-full text-left focus:outline-none">
            <h3 class="text-lg font-medium text-gray-800">How do I pay?</h3>
            <i data-feather="chevron-down" class="text-green-600"></i>
          </button>
          <div class="mt-2 text-gray-600">All payments are securely handled through our Stripe-powered billing portal.</div>
        </div>
        <div class="border-b pb-4" data-aos="fade-up" data-aos-delay="400">
          <button class="flex justify-between items-center w-full text-left focus:outline-none">
            <h3 class="text-lg font-medium text-gray-800">How often will I be charged?</h3>
            <i data-feather="chevron-down" class="text-green-600"></i>
          </button>
          <div class="mt-2 text-gray-600">You'll be billed weekly, even if you are on twice or thrice weekly visits.</div>
        </div>
      </div>
    </div>
  </section>

  <footer class="bg-gray-800 text-white py-12">
    <div class="container mx-auto px-6">
      <div class="md:flex md:justify-between">
        <div class="mb-8 md:mb-0">
          <h3 class="text-2xl font-bold mb-4">Scoop Duty KC</h3>
          <p class="text-gray-400">Professional pet waste removal serving the Kansas City metro area.</p>
        </div>
        <div class="grid grid-cols-2 gap-8">
          <div>
            <h4 class="text-lg font-semibold mb-4">Quick Links</h4>
            <ul class="space-y-2">
              <li><a href="#services" class="text-gray-400 hover:text-white">Services</a></li>
              <li><a href="#pricing" class="text-gray-400 hover:text-white">Pricing</a></li>
              <li><a href="#faq" class="text-gray-400 hover:text-white">FAQ</a></li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-4">Contact</h4>
            <ul class="space-y-2">
              <li class="flex items-center text-gray-400"><i data-feather="mail" class="mr-2"></i> info@scoop-duty.com</li>
              <li class="flex items-center text-gray-400"><i data-feather="phone" class="mr-2"></i> (123) 456-7890</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
        <p>&copy; 2025 Scoop Duty KC. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script>
    // Firebase config (your literals kept; can be overridden by /api/public-env if provided)
    const firebaseConfig = {
      apiKey: "AIzaSyBiCaBDOOql_0MO1KRWaATh-ATc60TutMw",
      authDomain: "scoop-duty.firebaseapp.com",
      projectId: "scoop-duty",
      storageBucket: "scoop-duty.firebasestorage.app",
      messagingSenderId: "888851571683",
      appId: "1:888851571683:web:d48f67ba25c6bd780bb6d6"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    let stripe = null;
    async function initStripe() {
      if (stripe) return stripe;
      const res = await fetch('/api/public-env');
      const data = await res.json();
      console.log('public-env', data);
      if (!data.publishableKey) {
        console.error('Missing STRIPE_PUBLISHABLE_KEY from server');
      }
      stripe = Stripe(data.publishableKey || '');
      return stripe;
    }

    AOS.init({ duration: 800, easing: 'ease-in-out', once: true });
    feather.replace();

    auth.onAuthStateChanged(async (user) => {
      const loginBtn = document.getElementById('loginBtn');
      const signupBtn = document.getElementById('signupBtn');
      if (user) {
        if (loginBtn) loginBtn.textContent = 'Account';
        if (signupBtn) signupBtn.textContent = 'Logout';
        await createStripeCustomer(user);
      } else {
        if (loginBtn) loginBtn.textContent = 'Login';
        if (signupBtn) signupBtn.textContent = 'Sign Up';
      }
    });

    document.getElementById('loginBtn').addEventListener('click', () => {
      if (auth.currentUser) {
        window.location.href = '/account';
      } else {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider)
          .then(async (result) => { await createStripeCustomer(result.user); })
          .catch((error) => console.error('Login error:', error));
      }
    });

    document.getElementById('signupBtn').addEventListener('click', () => {
      if (auth.currentUser) {
        auth.signOut();
      } else {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider)
          .then(async (result) => { await createStripeCustomer(result.user); })
          .catch((error) => console.error('Signup error:', error));
      }
    });

    async function createStripeCustomer(user) {
      try {
        const resp = await fetch('/api/create-customer', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${await user.getIdToken()}`
          },
          body: JSON.stringify({
            email: user.email,
            name: user.displayName || '',
            firebaseUid: user.uid
          })
        });
        const data = await resp.json();
        return data.customerId;
      } catch (e) {
        console.error('Error creating Stripe customer:', e);
        return null;
      }
    }

    const usd = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' });
    const norm = s => (s || '').toLowerCase().replace(/\s+/g,' ').trim();

    const PRICE_TABLE = {
      'onetime yard scooping': 25.00,
      'onetime doggy playtime': 30.00,
      'onetime litter trade': 20.00,
      'three weekly, 4+ boxes': 37.50,
      'three weekly, 1 box': 22.50,
      'once weekly, 4+ boxes': 25.00,
      'twice weekly, 2 boxes': 22.50,
      'twice weekly, 4+ boxes': 32.50,
      'once weekly, 1 box': 10.00,
      'once weekly, 3 boxes': 20.00,
      'twice weekly, 3 boxes': 27.50,
      'three weekly, 3 boxes': 32.50,
      'three weekly, 2 boxes': 27.50,
      'twice weekly, 1 box': 17.50,
      'once weekly, 2 boxes': 15.00,
      'three weekly, 5+ dogs': 85.00,
      'twice weekly, 5+ dogs': 75.00,
      'one weekly, 5+ dogs': 60.00,
      'three weekly, 4 dogs': 75.00,
      'twice weekly, 4 dogs': 65.00,
      'once weekly, 4 dogs': 50.00,
      'three weekly, 3 dogs': 65.00,
      'twice weekly, 3 dogs': 55.00,
      'once weekly, 3 dogs': 40.00,
      'three weekly, 2 dogs': 55.00,
      'twice weekly, 2 dogs': 45.00,
      'once weekly, 2 dogs': 30.00,
      'three weekly, 1 dog': 45.00,
      'twice weekly, 1 dog': 35.00,
      'once weekly, 1 dog': 20.00,
      'three weekly, 5+ dogs, large yard': 60.00,
      'three weekly, 5+ dogs, medium yard': 55.00,
      'three weekly, 5+ dogs, small yard': 50.00,
      'three weekly, 4 dogs, large yard': 55.00,
      'three weekly, 4 dogs, medium yard': 50.00,
      'three weekly, 4 dogs, small yard': 45.00,
      'three weekly, 3 dogs, large yard': 50.00,
      'three weekly, 3 dogs, medium yard': 45.00,
      'three weekly, 3 dogs, small yard': 40.00,
      'three weekly, 2 dogs, large yard': 45.00,
      'three weekly, 2 dogs, medium yard': 40.00,
      'three weekly, 2 dogs, small yard': 35.00,
      'three weekly, 1 dog, large yard': 40.00,
      'three weekly, 1 dog, medium yard': 35.00,
      'three weekly, 1 dog, small yard': 30.00,
      'twice weekly, 5 dogs, large yard': 55.00,
      'twice weekly, 4 dogs, large yard': 50.00,
      'twice weekly, 3 dogs, large yard': 45.00,
      'twice weekly, 2 dogs, large yard': 40.00,
      'twice weekly, 5+ dogs, medium yard': 50.00,
      'twice weekly, 4 dogs, medium yard': 45.00,
      'twice weekly, 4 dogs, small yard': 40.00,
      'twice weekly, 1 dog, large yard': 35.00,
      'twice weekly, 1 dog, medium yard': 30.00,
      'twice weekly, 1 dog, small yard': 25.00,
      'twice weekly, 3 dogs, small yard': 35.00,
      'twice weekly, 2 dogs, small yard': 30.00,
      'once weekly, 5+ dogs, large yard': 50.00,
      'once weekly, 5+ dogs, medium yard': 45.00,
      'once weekly, 5+ dogs, small yard': 40.00,
      'once weekly, 4 dogs, large yard': 45.00,
      'once weekly, 4 dogs, medium yard': 40.00,
      'once weekly, 4 dogs, small yard': 35.00,
      'once weekly, 3 dogs, large yard': 35.00,
      'once weekly, 3 dogs, medium yard': 30.00,
      'once weekly, 3 dogs, small yard': 25.00,
      'once weekly, 2 dogs, large yard': 30.00,
      'once weekly, 2 dogs, medium yard': 25.00,
      'once weekly, 2 dogs, small yard': 20.00,
      'once weekly, 1 dog, large yard': 25.00,
      'once weekly, 1 dog, medium yard': 20.00,
      'once weekly, 1 dog, small yard': 15.00
    };

    const aliasKeys = (k) => {
      const out = new Set([k]);
      if (k.includes('once weekly')) out.add(k.replace('once weekly','one weekly'));
      if (k.includes('one weekly')) out.add(k.replace('one weekly','once weekly'));
      if (k.includes('5+ dogs')) out.add(k.replace('5+ dogs','5 dogs'));
      if (k.includes('5 dogs')) out.add(k.replace('5 dogs','5+ dogs'));
      if (/^three weekly/i.test(k)) out.add(k.replace(/^Three weekly/,'three weekly'));
      return Array.from(out);
    };

    const toCsvFreq = (ui) => {
      const v = norm(ui);
      if (v.includes('one-time')) return 'onetime';
      if (v === 'weekly') return 'once weekly';
      if (v === 'bi-weekly') return 'twice weekly';
      if (v === 'three weekly') return 'three weekly';
      return v;
    };
    const toCsvPets = (ui) => norm(ui);
    const toCsvYard = (ui) => {
      const l = norm(ui);
      if (l.startsWith('small')) return 'small yard';
      if (l.startsWith('medium')) return 'medium yard';
      if (l.startsWith('large')) return 'large yard';
      return '';
    };
    const toCsvBoxes = (ui) => norm(ui);

    const serviceTypeEl = document.getElementById('serviceType');
    serviceTypeEl.addEventListener('change', () => {
      document.querySelectorAll('[id$="-options"]').forEach(el => el.classList.add('hidden'));
      document.getElementById(`${serviceTypeEl.value}-options`).classList.remove('hidden');
      updatePrice();
    });

    function buildKey() {
      const service = serviceTypeEl.value;
      if (service === 'yard-scooping') {
        const wrap = document.getElementById('yard-scooping-options');
        const f = toCsvFreq(wrap.querySelector('select[data-field="frequency"]').value);
        if (f === 'onetime') return 'onetime yard scooping';
        const pets = toCsvPets(wrap.querySelector('select[data-field="pets"]').value);
        const yard = toCsvYard(wrap.querySelector('select[data-field="yardSize"]').value);
        return norm(`${f}, ${pets}, ${yard}`);
      }
      if (service === 'doggy-playtime') {
        const wrap = document.getElementById('doggy-playtime-options');
        const f = toCsvFreq(wrap.querySelector('select[data-field="frequency"]').value);
        if (f === 'onetime') return 'onetime doggy playtime';
        const pets = toCsvPets(wrap.querySelector('select[data-field="pets"]').value);
        return norm(`${f}, ${pets}`);
      }
      if (service === 'litter-trade') {
        const wrap = document.getElementById('litter-trade-options');
        const f = toCsvFreq(wrap.querySelector('select[data-field="frequency"]').value);
        if (f === 'onetime') return 'onetime litter trade';
        const boxes = toCsvBoxes(wrap.querySelector('select[data-field="boxes"]').value);
        return norm(`${f}, ${boxes}`);
      }
      return '';
    }

    function lookupPrice(key) {
      if (!key) return null;
      for (const k of aliasKeys(key)) {
        const val = PRICE_TABLE[norm(k)];
        if (val !== undefined) return val;
      }
      return null;
    }

    function updatePrice() {
      const service = serviceTypeEl.value;
      const wrap = document.getElementById(`${service}-options`);
      const priceEl = wrap.querySelector('.js-price');
      const noteEl  = wrap.querySelector('.js-note');
      const freqLabelEl = wrap.querySelector('.js-frequency-label');

      const key = buildKey();
      const price = lookupPrice(key);

      if (price != null) {
        priceEl.textContent = usd.format(price);
        if (noteEl) noteEl.textContent = '';
      } else {
        priceEl.textContent = '$—';
        if (noteEl) noteEl.textContent = key ? `No CSV match: "${key}"` : '';
      }

      const freqUI = wrap.querySelector('select[data-field="frequency"]').value;
      const isOneTime = /one-time/i.test(freqUI);
      if (freqLabelEl) freqLabelEl.textContent = isOneTime ? 'one time' : 'weekly';
    }

    document.getElementById('pricing').addEventListener('change', (e) => {
      if (e.target.tagName === 'SELECT') updatePrice();
    });

    const PRICE_IDS = {"onetime yard scooping":"price_1S4SQLRzSCSZiE1R6YBer4cZ","onetime doggy playtime":"price_1S4SPURzSCSZiE1RrLUYru5Z","onetime litter trade":"price_1S4SP8RzSCSZiE1RGHuQugOG","three weekly, 4+ boxes":"price_1S4SMkRzSCSZiE1R7NfCh5SK","three weekly, 1 box":"price_1S4SMkRzSCSZiE1RSsgGk0q0","once weekly, 4+ boxes":"price_1S4SMkRzSCSZiE1RTnjCXsc1","twice weekly, 2 boxes":"price_1S4SMkRzSCSZiE1RDKVJEEhC","twice weekly, 4+ boxes":"price_1S4SMkRzSCSZiE1RQvJhd8Qf","once weekly, 1 box":"price_1S4SMkRzSCSZiE1RJfqUq3lG","once weekly, 3 boxes":"price_1S4SMkRzSCSZiE1RAdpBMbZo","twice weekly, 3 boxes":"price_1S4SMkRzSCSZiE1RzyBnrWuL","three weekly, 3 boxes":"price_1S4SMkRzSCSZiE1Ra3vgD0at","three weekly, 2 boxes":"price_1S4SMkRzSCSZiE1Ry3Y3e4uj","twice weekly, 1 box":"price_1S4SMkRzSCSZiE1RNWAoEUNN","once weekly, 2 boxes":"price_1S4SMjRzSCSZiE1RYjwR8hZA","three weekly, 5+ dogs":"price_1S4S97RzSCSZiE1R4TlRQ9SJ","twice weekly, 5+ dogs":"price_1S4S8uRzSCSZiE1Rjmo5rn1Q","one weekly, 5+ dogs":"price_1S4S8hRzSCSZiE1RA92U91Ga","three weekly, 4 dogs":"price_1S4S8HRzSCSZiE1RJH9QitJg","twice weekly, 4 dogs":"price_1S4S83RzSCSZiE1RhQkTV8lH","once weekly, 4 dogs":"price_1S4S7uRzSCSZiE1Rj6E6VQeR","three weekly, 3 dogs":"price_1S4S7eRzSCSZiE1RvyWQfGVO","twice weekly, 3 dogs":"price_1S4S7TRzSCSZiE1Rk1smZKZJ","once weekly, 3 dogs":"price_1S4S7KRzSCSZiE1R6bQyOALX","three weekly, 2 dogs":"price_1S4S6wRzSCSZiE1RUb9CPlCh","twice weekly, 2 dogs":"price_1S4S6kRzSCSZiE1R4k9cBv0w","once weekly, 2 dogs":"price_1S4S6XRzSCSZiE1R1zI1UE9X","three weekly, 1 dog":"price_1S4S6GRzSCSZiE1R6wB1a4pq","twice weekly, 1 dog":"price_1S4S5yRzSCSZiE1Rk1T7wzN4","once weekly, 1 dog":"price_1S4S5lRzSCSZiE1RkO2sCqgP","three weekly, 5+ dogs, large yard":"price_1S4S5URzSCSZiE1R5nN7YF7a","three weekly, 5+ dogs, medium yard":"price_1S4S5FRzSCSZiE1R1YqkM0s9","three weekly, 5+ dogs, small yard":"price_1S4S51RzSCSZiE1R6zV8N7wK","three weekly, 4 dogs, large yard":"price_1S4S4oRzSCSZiE1RkYH5x1eQ","three weekly, 4 dogs, medium yard":"price_1S4S4bRzSCSZiE1RrHq8eH93","three weekly, 4 dogs, small yard":"price_1S4S4PRzSCSZiE1R7m8L3iGQ","three weekly, 3 dogs, large yard":"price_1S4S4ARzSCSZiE1RM6d2t0pH","three weekly, 3 dogs, medium yard":"price_1S4S39RzSCSZiE1R1bqp1PzG","three weekly, 3 dogs, small yard":"price_1S4S3oRzSCSZiE1R4I8emc1Z","three weekly, 2 dogs, large yard":"price_1S4S3ZRzSCSZiE1R3K0vI2mK","three weekly, 2 dogs, medium yard":"price_1S4S3MRzSCSZiE1R5Kj6b8Yf","three weekly, 2 dogs, small yard":"price_1S4S3BRzSCSZiE1R9Ft2kT3W","three weekly, 1 dog, large yard":"price_1S4S2xRzSCSZiE1Rk1m0m8cE","three weekly, 1 dog, medium yard":"price_1S4S2kRzSCSZiE1Ruz6X2m5V","three weekly, 1 dog, small yard":"price_1S4S2XRzSCSZiE1Rr2n5C0qB","twice weekly, 5 dogs, large yard":"price_1S4S2IRzSCSZiE1R3cQw9u7L","twice weekly, 4 dogs, large yard":"price_1S4S1zRzSCSZiE1R0xKk4YhL","twice weekly, 3 dogs, large yard":"price_1S4S1lRzSCSZiE1R3wU7kF5B","twice weekly, 2 dogs, large yard":"price_1S4S1WRzSCSZiE1Rk6B2qH0Z","twice weekly, 5+ dogs, medium yard":"price_1S4S1JRzSCSZiE1R2bC3nV6M","twice weekly, 4 dogs, medium yard":"price_1S4S07RzSCSZiE1Rk7L8mN4P","twice weekly, 4 dogs, small yard":"price_1S4S0qRzSCSZiE1Rr8C9bV2H","twice weekly, 1 dog, large yard":"price_1S4S0bRzSCSZiE1R1kM0pN4V","twice weekly, 1 dog, medium yard":"price_1S4S0PRzSCSZiE1Rk4Q6nM8B","twice weekly, 1 dog, small yard":"price_1S4S09RzSCSZiE1R7zL1bN3M","twice weekly, 3 dogs, small yard":"price_1S4S0ARzSCSZiE1R0nB7vL5Z","twice weekly, 2 dogs, small yard":"price_1S4S0BRzSCSZiE1R8tM2sN6Q","once weekly, 5+ dogs, large yard":"price_1S4S0CRzSCSZiE1R7vQ2zN9B","once weekly, 5+ dogs, medium yard":"price_1S4S0DRzSCSZiE1R4nM7bK2P","once weekly, 5+ dogs, small yard":"price_1S4S0ERzSCSZiE1R3vN5lK8D","once weekly, 4 dogs, large yard":"price_1S4S0FRzSCSZiE1R2mJ6hP4V","once weekly, 4 dogs, medium yard":"price_1S4S0GRzSCSZiE1R5bV8cK3Q","once weekly, 4 dogs, small yard":"price_1S4S0HRzSCSZiE1R9kM1qL7S","once weekly, 3 dogs, large yard":"price_1S4S0IRzSCSZiE1R8nB5mC2Q","once weekly, 3 dogs, medium yard":"price_1S4S0JRzSCSZiE1R2qN4xV8L","once weekly, 3 dogs, small yard":"price_1S4S0KRzSCSZiE1R6pB7cD4M","once weekly, 2 dogs, large yard":"price_1S4S0LRzSCSZiE1R7mC5nB2V","once weekly, 2 dogs, medium yard":"price_1S4S0MRzSCSZiE1R8bN4cM6K","once weekly, 2 dogs, small yard":"price_1S4S0NRzSCSZiE1R4mK7bC2N","once weekly, 1 dog, large yard":"price_1S4S0ORzSCSZiE1R9vB1nM5Q","once weekly, 1 dog, medium yard":"price_1S4S0PRzSCSZiE1R6mN3bC8K","once weekly, 1 dog, small yard":"price_1S4S0QRzSCSZiE1R2bV5nK8L"};

    function isOneTimeKey(k) { return /^onetime\s/i.test(k); }

    async function goToCheckout(priceId, service, optionsKey) {
      try {
        const user = auth.currentUser;
        if (!user) { alert('Please sign in to continue'); return; }
        const token = await user.getIdToken();
        const s = await initStripe();
        const response = await fetch('/api/create-checkout-session', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({
            priceId,
            service,
            optionsKey,
            mode: isOneTimeKey(optionsKey) ? 'payment' : 'subscription'
          })
        });
        const session = await response.json();
        if (!session?.id) throw new Error('Missing session id');
        console.log('Redirecting to Stripe Checkout with session', session.id, 'mode', session.mode);
        await s.redirectToCheckout({ sessionId: session.id });
      } catch (error) {
        console.error('Checkout error:', error);
        alert('Checkout failed. Please try again.');
      }
    }

    function initStripeButtons() {
      document.querySelectorAll('.js-checkout-btn').forEach(btn => {
        btn.addEventListener('click', async () => {
          const service = serviceTypeEl.value;
          const key = buildKey();
          const priceId = PRICE_IDS[key] || PRICE_IDS[norm(key)];
          if (!priceId) { alert('Please select valid options'); return; }
          await goToCheckout(priceId, service, key);
        });
      });
    }

    initStripeButtons();
    updatePrice();
  </script>
</body>
</html>
